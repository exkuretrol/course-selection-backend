{% extends "base.twig" %} {% block title %}ç®¡ç†é é¢{% endblock title %} {% block
head %}
{{ parent() }}
<style type="text/tailwindcss">
    @layer components {
        .confirm-delete {
            @apply bg-red-500;
        }

        .modifying {
            @apply bg-emerald-300;
        }
    }
</style>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        $("#tabs").tabs();

        function load_table() {
            $.ajax({
                url: "/api/ner/category",
            }).then((res) => {
                res.map((option, i) => {
                    const row = `
                    <tr id="${"cate" + option.ID}">
                        <td>
                            <input class="name" type="text" value="${
                                option.Name
                            }" disabled>
                        </td>
                        <td>
                            <input class="tag" type="text" value="${
                                option.Tag
                            }" disabled>
                        </td>
                        <td class="modify">âœï¸</td>
                        <td class="delete">ğŸ—‘ï¸</td>
                    </tr>
                    `;
                    $("#category-table > tbody").append(row);
                    $(`#cate${option.ID} .delete`).on("click", (e) => {
                        if (
                            $(`#cate${option.ID} .delete`).hasClass(
                                "confirm-delete"
                            )
                        ) {
                            $(`#cate${option.ID}`).remove();
                            $.ajax({
                                url: `/api/ner/category/${option.ID}`,
                                type: "delete",
                                contentType: "application/json; charset=utf-8",
                            });
                        } else {
                            $(`#cate${option.ID} .delete`).addClass(
                                "confirm-delete"
                            );
                        }
                    });

                    $(`#cate${option.ID} .modify`).on("click", (e) => {
                        if ($(`#cate${option.ID} .modify`).text() == "âœï¸") {
                            $(`#cate${option.ID} input`).removeAttr(
                                "disabled",
                                false
                            );
                            $(`#cate${option.ID} .modify`).addClass(
                                "modifying"
                            );

                            $(`#cate${option.ID} .modify`).text("ğŸ‘Œ");
                            // console.log("can modify");
                        } else {
                            $(`#cate${option.ID} input`).attr("disabled", true);
                            $(`#cate${option.ID} .modify`).removeClass(
                                "modifying"
                            );
                            $(`#cate${option.ID} .modify`).text("âœï¸");

                            const data = {
                                ID: option.ID,
                                Name: $(`#cate${option.ID} input.name`).val(),
                                Tag: $(`#cate${option.ID} input.tag`).val(),
                            };

                            $.ajax({
                                url: `/api/ner/category`,
                                type: "put",
                                data: JSON.stringify(data),
                                contentType: "application/json; charset=utf-8",
                            });
                            // console.log("cann't modify");
                        }
                    });
                });
            });
        }
        load_table();

        $("#create-tag").on("click", (e) => {
            const name = $("#new-category-name").val();
            const tag = $("#new-category-tag").val();
            if (name !== "" && tag !== "") {
                $.ajax({
                    url: `/api/ner/category`,
                    type: "post",
                    data: JSON.stringify({ Name: name, Tag: tag }),
                    contentType: "application/json; charset=utf-8",
                    success: () => {
                        $("#new-category-name").val("");
                        $("#new-category-tag").val("");
                        $("#category-table > tbody").children().remove();
                        load_table();
                    },
                });
            }
        });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let url;
        $("#download-btn").attr("disabled", true);
        $("#download-btn").on("click", (e) => {
            e.preventDefault();
            document.getElementById("download-link").click();
            $("#download-link").remove();
            $("#download-btn").attr("disabled", true);
        });
        $("#output-ner-data-to-json").on("change", (e) => {
            const mode = e.target.value;
            if (mode === "null") return;
            $.ajax({
                type: "get",
                url: `/api/output/${mode}`,
                success: (res) => {
                    let json = new Blob(
                        [
                            JSON.stringify(res)
                                .replace(/\[{"tokens"/g, '{"tokens"')
                                .replace(/\]}]/g, "]}")
                                .replace(/,{"tokens"/g, '\n{"tokens"'),
                        ],
                        { type: "application/json" }
                    );
                    url = URL.createObjectURL(json);
                    let downloadLink = document.createElement("a");
                    downloadLink.id = "download-link";
                    downloadLink.download = $(
                        "#output-ner-data-to-json :selected"
                    ).text();
                    downloadLink.href = url;
                    downloadLink.style.display = "none";
                    if ($("#download-link").length > 0)
                        $("#download-link").remove();
                    document.body.appendChild(downloadLink);
                    $("#download-btn").removeAttr("disabled");
                },
            });
        });
    });
</script>
{% endblock head %} {% block main %}
<div id="tabs" class="flex flex-row">
    <!-- sidebar -->
    <div class="mr-4 w-60 border-r border-black">
        <ul>
            <li><a href="#tabs-1">è¼¸å‡ºæ¸¬è³‡</a></li>
            <li><a href="#tabs-2">è®Šæ›´ NER æ¨™ç±¤</a></li>
        </ul>
    </div>

    <!-- main -->
    <div class="w-auto">
        <div id="tabs-1">
            <label for="output-ner-data-to-json">è¼¸å‡ºæ¸¬è³‡ï¼š</label>
            <select name="output-ner-data-to-json" id="output-ner-data-to-json">
                <option value="null" selected>è«‹é¸æ“‡</option>
                <option value="0">å…¨éƒ¨æ¸¬è³‡</option>
                <option value="1">åªæœ‰è¼¸å…¥æ¸¬è³‡</option>
                <option value="2">åªæœ‰èªéŸ³æ¸¬è³‡</option>
            </select>
            <div>
                <button id="download-btn">ä¸‹è¼‰</button>
            </div>
        </div>
        <div id="tabs-2">
            <div id="modify-exist-category">
                <table id="category-table">
                    <thead>
                        <tr>
                            <td>åç¨±</td>
                            <td>æ¨™ç±¤</td>
                            <td>ç·¨è¼¯</td>
                            <td>ç§»é™¤</td>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div id="add-new-tag">
                <div class="flex flex-row">
                    <input
                        id="new-category-name"
                        type="text"
                        placeholder="æ¨™ç±¤åç¨±"
                    />
                    <input
                        id="new-category-tag"
                        type="text"
                        placeholder="è‹±æ–‡æ¨™ç±¤"
                    />
                </div>
                <button id="create-tag">æ–°å¢æ¨™ç±¤</button>
            </div>
        </div>
    </div>
</div>
{% endblock main %}
